image: nixos/20.03
repositories:
  nixos: https://nixos.org/channels/nixos-20.03
packages:
  - nixos.cachix
sources:
  - https://git.sr.ht/~aasg/nixexprs
secrets:
  - 06d44cfd-6ded-45c4-9ef4-8e1433f9054e
tasks:
  - prepare: |
      cachix use aasg-nixexprs
  - build: |
      set -o pipefail
      nix-build --no-out-link --keep-going --keep-failed nixexprs | tee built-paths
  - cache: |
      cachix push aasg-nixexprs <built-paths
