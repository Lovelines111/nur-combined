language: nix
sudo: false
env:
  global:
  - CACHIX_CACHE=gricad
  - NUR_REPO=https://github.com/Gricad/nur-packages
  - secure: JYIW90fCihFmpF9LsTZBxw0CfYW63j+sE6dqjMwTYS+cg41Jms2pKjAjU4hM7IMjoLKcP+ArYwM88bx6+eI8SmANSeCumCbo4ioCUL0NXNV5cKi5SmXwHGuHprtyKZRPb+5AkEZkZS0FHxcZLFITppIxlwQ8wsQ+bRA2XcmiyeF86xPa0O+xj+MFyJYVizqOWFFMK0cktFmo1P4yxtK71+ERxM8ugYb1s0tk6pxbaTfO8Blqc0GwR+Twgkow0Om5G7XQ4IEePd77n9di5Q/Z2GBUZYZlalqcQlXdwzsDpuNIRuo80TS3ZTCFkT9oAkerENudEgyb3L72mQYSbsf862a02u7EH2dXRDvjBsu33kN3q29p8CJKwdwzDXQoKhJSdCDiG7Q6jFNHwwtKqTLj76Ss3FVGld+lrFRkMWPnljnjSEPpxNQ/q7jBwZkqepFJvFV9LHc3cslBy47UvpEe+donkYjeGJK0uX1YxF4SHAi0XCVePBHgsqMd1pSBC/IwWuZ8amweLiAp0g5ASnnjfFdDNwoqsdbpYZQ9tTlJCcH89R2siJvX2YGT6EdVg3JtH6XYJQnNqbsihVkn6SSsApCRmj2Dyi6Z8BeCYu414xARmp4kg9Z7V4Md7wXNOSzewRfHV4ebEvfzmBnrFYAO5jbrt/mvSbIYVdZ7pcP8CCU=
matrix:
  include:
  - env: NIX_CHANNEL=https://nixos.org/channels/nixpkgs-unstable
  - env: NIX_CHANNEL=https://nixos.org/channels/nixos-unstable
  - env: NIX_CHANNEL=https://nixos.org/channels/nixos-19.09
install:
- nix --version
- if [ -n "${CACHIX_CACHE}" ]; then travis_retry nix-channel --update; fi
- if [ -n "${CACHIX_CACHE}" ]; then nix-env -iA cachix -f https://cachix.org/api/v1/install;
  fi
- if [ -n "${CACHIX_CACHE}" ]; then cachix use "${CACHIX_CACHE}"; fi
- nix-channel --add "${NIX_CHANNEL}" nixpkgs
- travis_retry nix-channel --update
script:
- nix-build ci.nix -A buildOutputs | cachix push "${CACHIX_CACHE}"
- nix eval -f default.nix 'lib'
- nix eval -f default.nix 'modules'
- nix eval -f default.nix 'overlays'
after_success:
- if [ -n "${CACHIX_CACHE}" ]; then nix-build ci.nix -A cacheOutputs | cachix push
  "${CACHIX_CACHE}"; fi
- if [ "false" = "${TRAVIS_PULL_REQUEST}" -a "master" = "${TRAVIS_BRANCH}" ]; then
  curl -XPOST "https://nur-update.herokuapp.com/update?repo=${NUR_REPO}"; fi
