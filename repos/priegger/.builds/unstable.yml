image: nixos/latest
packages:
  - nixpkgs.nixpkgs-fmt
repositories:
  nixpkgs: https://nixos.org/channels/nixos-unstable
sources:
  - https://git.sr.ht/~priegger/nur-packages
tasks:
  - build: |
      cd nur-packages

      nix-build ci.nix -A buildOutputs
      nix eval -f nur.nix 'lib'
      nix eval -f nur.nix 'modules'
      nix eval -f nur.nix 'overlays'

      nix-build -E 'with import <nixpkgs>{}; (callPackage ./default.nix {})'
  - test: |
      cd nur-packages
      nix-build ./tests/reresolve-dns.nix
  - lint: |
      cd nur-packages
      find . -name '*.nix' -exec nixpkgs-fmt --check {} +
