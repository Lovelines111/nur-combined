#!/usr/bin/env bash

# Inspired by https://gitlab.com/Andrew/configuration/-/blob/c7de6235e00c906dc7016dcce9d6edcd4117c452/tasks/update
# See https://discourse.nixos.org/t/25274

if [ "$(type -t loadDotfilesEnv)" == function ]; then
  loadDotfilesEnv
fi

set -eu
prefix="$(readlink --canonicalize -- "$(dirname -- "$0")/../packages")"
nixpkgs="$(nix-instantiate --eval --expr '<nixpkgs>')"

nix-shell "$nixpkgs/maintainers/scripts/update.nix" \
  --arg include-overlays 'import <nixpkgs-overlays>' \
  --argstr path "$1"

